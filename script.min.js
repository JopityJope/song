const searchBtn = document.querySelector(".search_btn"),
  searchEl = document.querySelector(".search"),
  input = document.querySelector(".search_input"),
  background = document.querySelector(".search_section"),
  songList = document.querySelector(".song_list"),
  songSection = document.querySelector(".song"),
  loader = document.querySelector(".loader"),
  message = document.querySelector(".message"),
  searchIcon = document.querySelector(".search_icon");
(input.value = ""),
  background.addEventListener("click", function (e) {
    e.target.classList.contains("search_section") &&
      0 === input.value.length &&
      ((searchIcon.innerHTML =
        '<use xlink:href="img/sprite.svg#icon-search"></use>'),
      searchEl.classList.remove("search--active"),
      searchBtn.classList.remove("search_btn--remove"));
  }),
  window.addEventListener("keydown", function (e) {
    "Escape" === e.key && 0 === input.value.trim().length
      ? (searchEl.classList.remove("search--active"),
        searchBtn.classList.remove("search_btn--remove"),
        (searchIcon.innerHTML =
          '<use xlink:href="img/sprite.svg#icon-search"></use>'))
      : "Escape" === e.key &&
        ((input.value = ""),
        removeItems(),
        clearMessage(),
        searchBtn.classList.add("search_btn--remove"));
  }),
  searchBtn.addEventListener("click", function () {
    if (0 === input.value.trim().length) {
      searchEl.classList.toggle("search--active"),
        searchBtn.classList.add("search_btn--remove");
      let e = function () {
        input.focus();
      };
      setTimeout(e, 1200);
    } else 0 !== input.value.trim().length && ((input.value = ""), removeItems(), clearMessage(), searchBtn.classList.add("search_btn--remove"));
  }),
  input.addEventListener("keyup", function () {
    removeItems(),
      loader.classList.add("loader--active"),
      clearMessage(),
      0 === input.value.trim().length
        ? (loader.classList.remove("loader--active"),
          clearMessage(),
          searchBtn.classList.add("search_btn--remove"))
        : 0 !== input.value.trim().length &&
          (getData(),
          (searchIcon.innerHTML =
            '<use xlink:href="img/sprite.svg#icon-close"></use>'),
          searchBtn.classList.remove("search_btn--remove"));
  });
const getData = async function () {
  try {
    let e = await fetch(
        `https://itunes.apple.com/search?term=${input.value}&entity=song`
      ),
      s = await e.json();
    console.log(s),
      0 === s.resultCount
        ? (loader.classList.remove("loader--active"),
          showNoResultsMessage(input.value))
        : (clearMessage(),
          loader.classList.remove("loader--active"),
          s.results.forEach(function (e, s) {
            s <= 4 && showItemsOnScreen(e);
          }));
  } catch {
    loader.classList.remove("loader--active"),
      removeItems(),
      showErrorMessage();
  }
};
function showItemsOnScreen(e) {
  let s = document.createElement("li");
  s.classList.add("song_item"),
    (s.innerHTML = `<span class="bold">${e.trackName}</span> - <span >${e.artistName}</span>`),
    songList.appendChild(s);
}
function removeItems() {
  let e = document.querySelectorAll(".song_item");
  e.forEach((e) => {
    songList.removeChild(e);
  });
}
function showNoResultsMessage(e) {
  message.innerHTML = `Nema rezultata za <span class="message_input">"${e}"</span>`;
}
function showErrorMessage() {
  message.innerHTML = "Nešto je pošlo po krivu. Pokušaj ponovno.";
}
function clearMessage() {
  message.innerHTML = "";
}
